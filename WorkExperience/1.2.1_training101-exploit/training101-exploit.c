#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char flag[64] = {0};

int getFlag(void);
void load_flag(void);

int main(int argc, char *argv[]) {

    setbuf(stdout, NULL);

    char myTeam = 'A';
    char response[64];

    memset(response, 0, strlen(response));

    printf("\n");
    printf(">> You approach the other teams base...\n");
    printf("\n");
    printf("Guard: 'Halt! Who goes there?'\n");
    printf("\n");

    printf("You respond: ");
    gets(response);
    printf("\n");

    printf("Guard: 'Hi %s','\n", response);
    printf("Guard: 'Your name isn't on the list...'\n");
    printf("Guard: 'Only team B is allowed to see the flag,'\n");
    printf("Guard: 'You're on team %c\n", myTeam);
    

    if (myTeam == 'B') {
        printf("Guard: 'Oh, I see you *are* on team %c! Come in!'", myTeam);
        getFlag();
    } else {
        printf("Guard: 'Come back if you're on the list.'\n");
        printf("\n");
    }

    return EXIT_SUCCESS;
}

int getFlag(void) {

    load_flag();
    printf("%s\n", flag);

    return EXIT_SUCCESS;
}

void load_flag(void) {

    FILE *file = fopen("/flag", "r");

    if (file == NULL) {
        strcpy(flag, "FLAG{DEBUGGING_FLAG}");
        return;
    }

    fread(flag, sizeof(flag), 1, file);
    fclose(file);

}
