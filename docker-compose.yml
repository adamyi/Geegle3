# how zero-trust network works:
# create separate networks for each service containing only that service and uberproxy
# this way all communication goes through uberproxy, even including inter-service ones
# we currently have a geegle_unsecure network but we will migrate all of them to
# beyondcorp later
#
# TODO: don't expose ports, put them behind uberproxy

version: '2'
services:
  kix:
    build: ./NewHire/kix
    networks:
      geegle_unsecure:
  redis:
    image: redis:latest
    networks:
      geegle_unsecure:
  mss:
    build: ./mss
    networks:
      geegle_unsecure:
  gae:
    build: ./gae
    networks:
      geegle_unsecure:
    ports:
    - "8056:80"
  uberproxy:
    build: ./uberproxy
    networks:
      beyondcorp_geemail_frontend:
      beyondcorp_geemail_backend:
    ports:
    - "80:80"

# High school
  web-filesystem:
    image: golang:1.11
    volumes:
      - ./WorkExperience/web-filesystem/generate_site.sh:/generate_site.sh
      - ./WorkExperience/web-filesystem/main.go:/main.go
    command: bash /generate_site.sh
    ports:
      - "9000:80"

  misc-quicksort:
    build: ./WorkExperience/misc-quicksort
    ports:
      - "8999:1000"
    read_only: true

  misc-who-is-attacking-me:
    build: ./WorkExperience/misc-who-is-attacking-me
    ports:
      - "8998:1000"
    read_only: true

  misc-etcpasswd:
    build: ./WorkExperience/crypto-etcpasswd
    ports:
      - "8997:1000"
    read_only: true



  web-local_intranet:
    build: ./WorkExperience/web-intranet
    ports:
      - "9001:80"
    hostname: internal.docs

  web-intern-management:
    build: ./WorkExperience/web-intern-account-manager
    ports:
      - "9002:80"

  web-guest-kiosk:
    build: ./WorkExperience/web-guest-kiosk
    ports:
      - "9003:80"

  web-privatefile:
    build: ./WorkExperience/web-privatefile
    ports:
      - "9004:80"



  pwn-intern-project:
    build: ./WorkExperience/pwn-intern-project
    ports:
      - "19204:19204"
    read_only: true


# NewHires
  pwn-mailserver-dev:
    build: ./NewHire/pwn-mailserver-dev
    ports:
      - "587:9999"
    read_only: true
  pwn-payroll:
    build: ./NewHire/pwn-payroll
    ports:
      - "19200:1000"
    read_only: true
  pwn-game:
    build: ./NewHire/pwn-game
    ports:
      - "19201:1000"
    read_only: true
  re-trycatch:
    build: ./NewHire/re-trycatch
    ports:
      - "19202:1000"
    read_only: true
  geemail_frontend:
    build: ./geemail-frontend
    networks:
      beyondcorp_geemail_frontend:
        aliases:
          - mail.corp.geegle.org
  geemail_backend:
    build: ./geemail-backend
    networks:
      beyondcorp_geemail_backend:
        aliases:
          - geemail-backend.corp.geegle.org

networks:
  geegle_unsecure:
  beyondcorp_geemail_frontend:
  beyondcorp_geemail_backend:
